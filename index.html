<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Top 100 Exploration Projects</title>
  <link rel="stylesheet" href="https://js.arcgis.com/4.24/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.24/"></script>
  <style>
    html, body, #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }

    #layerListContainer {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 999;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
    }

    #showHideLayers {
      position: absolute;
      top: 10px;
      right: 10px; /* Adjust right position */
      z-index: 1000; /* Ensure the button is on top */
      background-color: #0079c1;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="viewDiv"></div>
  <button id="showHideLayers">Show Layer List</button>
  <div id="layerListContainer" style="display: none;">
    <div id="layerList"></div>
  </div>
  <script>
    require([
      "esri/Map",
      "esri/views/MapView",
      "esri/layers/FeatureLayer",
      "esri/widgets/LayerList",
      "esri/PopupTemplate",
    ], function (Map, MapView, FeatureLayer, LayerList, PopupTemplate) {
      var map = new Map({
        basemap: "streets"
      });

      var view = new MapView({
        container: "viewDiv",
        map: map,
        center: [-98, 60],
        zoom: 3
      });

      // Define an array of layers with URLs, titles, and displayFields
      var layersInfo = [
      {
          url: "https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/900A_and_top_100_en/MapServer/0",
          title: "Top 100 Exploration Projects",
          displayField: "displayField1", // Change to your actual displayField
        },
        {
          url: "https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/900A_and_top_100_en/MapServer/1",
          title: "900A",
          displayField: "displayField2", // Change to your actual displayField
        },
        {
          url: "https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/900A_and_top_100_en/MapServer/2",
          title: "Oil and Gas",
          displayField: "minesite_en",
        },
        {
          url: "https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/900A_and_top_100_en/MapServer/3",
          title: "Producing Mines",
          displayField: "displayField3", // Change to your actual displayField
        },
        {
          url: "https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/900A_and_top_100_en/MapServer/4",
          title: "Metal mines",
          displayField: "operation_name_en",
        },
        {
          url: "https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/900A_and_top_100_en/MapServer/5",
          title: "Nonmetal mines",
          displayField: "operation_name_en",
        },
        {
          url: "https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/900A_and_top_100_en/MapServer/6",
          title: "Coal mines",
          displayField: "operation_name_en",
        },
        {
          url: "https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/900A_and_top_100_en/MapServer/7",
          title: "Oil sands mines",
          displayField: "operation_name_en",
        },
        {
          url: "https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/900A_and_top_100_en/MapServer/8",
          title: "Metallurgical Works",
          displayField: "displayField8", // Change to your actual displayField
        },
        {
          url: "https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/900A_and_top_100_en/MapServer/9",
          title: "Smelters and refineries",
          displayField: "operation_en",
        },
        {
          url: "https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/900A_and_top_100_en/MapServer/10",
          title: "Steel mills",
          displayField: "operation_en",
        },
        {
          url: "https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/900A_and_top_100_en/MapServer/11",
          title: "Ferroalloy plants",
          displayField: "operation_en",
        },
        {
          url: "https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/900A_and_top_100_en/MapServer/12",
          title: "Automobile shredders",
          displayField: "operation_en",
        }
      ];

      // Create FeatureLayers for each layer
      var layers = layersInfo.map(function (layerInfo) {
        return new FeatureLayer({
          url: layerInfo.url,
          title: layerInfo.title,
          outFields: ["*"],
          popupTemplate: new PopupTemplate({
            title: "{" + layerInfo.displayField + "}",
            content: createPopupContent(["*"])
          })
        });
      });

      // Add the layers to the map
      map.addMany(layers);

      // Create a LayerList widget
      var layerList = new LayerList({
        view: view
      });

      // Add the LayerList widget to the layerListContainer
      layerList.container = "layerList";

      // Show/hide the LayerList when the button is clicked
      var showHideLayersButton = document.getElementById("showHideLayers");
      showHideLayersButton.addEventListener("click", function () {
        var layerListContainer = document.getElementById("layerListContainer");
        if (layerListContainer.style.display === "none") {
          layerListContainer.style.display = "block";
          showHideLayersButton.innerText = "Hide Layer List";
        } else {
          layerListContainer.style.display = "none";
          showHideLayersButton.innerText = "Show Layer List";
        }
      });

      // Handle pointer-move event to show popups on hover
      view.on("pointer-move", function (event) {
        var screenPoint = {
          x: event.x,
          y: event.y
        };
        view.hitTest(screenPoint).then(function (response) {
          if (response.results.length > 0) {
            var feature = response.results[0].graphic;
            view.popup.open({
              features: [feature],
              location: event.mapPoint
            });
          } else {
            view.popup.close();
          }
        });
      });

      // Function to create popup content
      function createPopupContent(outFields) {
        return function (feature) {
          var attributes = feature.attributes;
          var content = "<table>";
          outFields.forEach(function (field) {
            content += "<tr><td><b>" + field + ":</b></td><td>" + attributes[field] + "</td></tr>";
          });
          content += "</table>";
          return content;
        };
      }
    });
  </script>
</body>
</html>
